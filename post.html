<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
        <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
     <style>
        a {
  text-decoration: none; /* Removes the underline from all links */}
  @media(max-width:790px){
.nav a{
    display: none !important;;
 }
  }
 

    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AMR2010M/butterfly-css@latest/attributes.css">
</head>
<body>
     <ul navbar bp twhite mb-50 class="nav">
<h1 tbp message blue-50 p-10  >Mc</h1>

<a href="/profile" twhite tsmall>profile </a>
<a href="/signin"twhite tsmall >signin </a>
<a href="/signout"twhite tsmall>signout </a>
<a href="/signup"twhite tsmall>sign up </a>
    </ul>
    <div w-full min-h-600 white id="x"  columns>
<section class="bg-white dark:bg-gray-900">
    <div class="max-w-3xl mx-auto px-4 py-8 bg-white dark:bg-gray-800 shadow-sm ltr:text-left rtl:text-right">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Comments</h2>
        <div class="mb-6 space-y-4">
            <input id="newName" placeholder="Your name" type="text" class="w-full p-4 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
            <textarea id="newComment" placeholder="Add your comment..." class="w-full p-4 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-y bg-white dark:bg-gray-700 text-gray-900 dark:text-white" rows="4"></textarea>
            <button id="addCommentBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Post Comment</button>
        </div>
        <div id="comments-list" class="space-y-4"></div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const commentsListEl = document.getElementById('comments-list');
        const newNameInput = document.getElementById('newName');
        const newCommentInput = document.getElementById('newComment');
        const addCommentBtn = document.getElementById('addCommentBtn');

        let comments = [{ name: 'Sarah Chen', text: 'Great article! Mindful coding really helps me stay focused.', timeAgo: '5 minutes ago' }];

        const renderComments = () => {
            commentsListEl.innerHTML = '';
            comments.forEach(comment => {
                const commentEl = document.createElement('div');
                commentEl.className = "border-l-4 rtl:border-l-0 rtl:border-r-4 border-blue-600 dark:border-blue-400 bg-gray-50 dark:bg-gray-900 p-4 rounded-r-lg rtl:rounded-r-none rtl:rounded-l-lg";
                commentEl.innerHTML = `
                    <div class="flex justify-between items-baseline mb-2">
                        <span class="font-semibold text-gray-900 dark:text-white">${comment.name}</span>
                        <span class="text-sm text-gray-500 dark:text-gray-400">${comment.timeAgo}</span>
                    </div>
                    <p class="text-gray-800 dark:text-gray-300">${comment.text}</p>
                `;
                commentsListEl.appendChild(commentEl);
            });
        };

        addCommentBtn.addEventListener('click', () => {
            if (newCommentInput.value.trim() && newNameInput.value.trim()) {
                comments.unshift({
                    name: newNameInput.value,
                    text: newCommentInput.value,
                    timeAgo: 'just now'
                });
                newNameInput.value = '';
                newCommentInput.value = '';
                renderComments();
            }
        });

        renderComments();
    });
</script>
    <script type="module">
const postId = new URLSearchParams(window.location.search).get('id');
    const x=document.getElementById('x');
     const c=document.getElementById('c');
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    const supabaseUrl = 'https://skhatgfvgvyociqfamsp.supabase.co';
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNraGF0Z2Z2Z3Z5b2NpcWZhbXNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5NDY3MjMsImV4cCI6MjA3NTUyMjcyM30.m0L9G26jHf79KNL_YCDNJHS2hWYHuJ4WCzLAHKhj2XI";

    const supabase = createClient(supabaseUrl, supabaseKey);
const {data:{user}}= await supabase.auth.getUser();
if(user){
    console.log('hello');
}
else{
    window.location.href="/signin";

}
 async function fetchpoems () {
    

const{data,error}=await supabase.from('poems').select('title,author,poem,img').eq('id',postId).single();
if(error){
    console.error(error);

}
else{
     
   

    const poem=data;
    const mypoem=`<div columns center style='white-space: pre-wrap;position: relative;' mb-50 center w-70p min-h-400 sblue rounded blue-50 p-30 ><h1 center tblue w-90p >${poem.title}</h1><p tsmall tblack>${poem.poem}</p><img w-50p h-400 center src='${poem.img}' > <p center >by ${poem.author}</p></div>`;
    
x.innerHTML+=mypoem;
   }
}

 
 fetchpoems();
 var submit=document.getElementById('submit');
 submit.onclick= async function(){
     
    var text=document.getElementById('text').value;



    const {error}=  await supabase.from('comments').insert({
text: text, 
post_id: postId ,
 user_id: user.id,
 user_name:user.email
    });
    if(error){
        alert(error);
    }
    else{
         alert('success');
    }
}
 async function getcomments() {
    

const{data,error}=await supabase.from('comments').select('*').eq('post_id',postId);
if(error){
    console.error(error);
}
else{
   for( const poem of data){
    const comment=`<a p-30  w-70p tblack><div   class='post' center b-green mb-50 center  rounded green-50 p-30 > <h1 center tblue  >${poem.text}</h1> <p bottom center style="position: absolute;">by ${poem.user_name}</p></div></a>`;
c.innerHTML+=comment;
}
}
 }
 getcomments();
</script>
</body>

</html>